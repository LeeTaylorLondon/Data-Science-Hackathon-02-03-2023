# Author: Lee Taylor
import requests
from bs4 import BeautifulSoup as BS
from Deprecated.Process_HTML import extract_elements


INTERVAL = 3600
HEADERS = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "
                  "(KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"}


def url_to_soup_obj(url: str) -> BS:
    try:
        page = requests.get(url, headers=HEADERS)
    except requests.exceptions.MissingSchema:
        print(f"\n[WARINING] - <link: {url}> - INVALID!")
        print("LINK DOES NOT CONTAIN PROTOCOL i.e 'https://'")
        return
    return BS(page.content, 'html5lib')


def google_search(search_str: str):
    # Convert search to google search URL
    gsearch_url = f"https://www.google.com/search?q={'+'.join(search_str.lower().split())}"
    # Generate 'soup' object of google search
    gsearch_soup = url_to_soup_obj(gsearch_url)
    # Extract URLs
    elms = extract_elements(str(gsearch_soup), elm='cite')
    # For-loop extracts URLs into list
    urls = []
    for string in elms:
        if string.__contains__("www."):
            urls.append(string.split()[0])
    # Return list of URLs
    return urls


def extract_text(soup, headers=True):
    # Find all HTML elements that contain the main content
    if headers: content_elements = soup.find_all(["p", "h1", "h2", "h3", "h4", "h5", "h6", "a", "li", "span", "strong", "em"])
    elif not headers: content_elements = soup.find_all(["p", "a", "li", "span", "strong", "em"])
    # Concatenate the text from all content elements
    content = [element.text.strip() for element in content_elements]
    for i, v in enumerate(content):
        content[i] = v.replace('\n', '')
        content[i] = content[i].replace('  ', '')
    # ['Home', 'Home', 'Home', 'About UsWelcome to OPGSEthos and ValuesStudent Destinations 2022History of the SchoolExamination ResultsStaff List', 'About Us', 'About Us', 'Welcome to OPGS', 'Welcome to OPGS', 'Welcome to OPGS', 'Ethos and Values', 'Ethos and Values', 'Ethos and Values', 'Student Destinations 2022', 'Student Destinations 2022', 'Student Destinations 2022', 'History of the School', 'History of the School', 'History of the School', 'Examination Results', 'Examination Results', 'Examination Results', 'Staff List', 'Staff List', 'Staff List', 'Joining OPGSAdmissions11+ Open EventsPrimary LinksProspectusSchool UniformVacanciesYear 6 TransitionAppeal Process', 'Joining OPGS', 'Joining OPGS', 'Admissions', 'Admissions', 'Admissions', '11+ Open Events', '11+ Open Events', '11+ Open Events', 'Primary Links', 'Primary Links', 'Primary Links', 'Prospectus', 'Prospectus', 'Prospectus', 'School Uniform', 'School Uniform', 'School Uniform', 'Vacancies', 'Vacancies', 'Vacancies', 'Year 6 Transition', 'Year 6 Transition', 'Year 6 Transition', 'Appeal Process', 'Appeal Process', 'Appeal Process', 'Sixth FormOverviewFaculty Tutor ProgrammeEnrichmentLeadershipSixth Form ProspectusOpen EventsEntrance RequirementsAdmissions and ApplicationsPastoral CareDress Code16+ Travel Card and BursarySixth Form Transition', 'Sixth Form', 'Sixth Form', 'Overview', 'Overview', 'Overview', 'Faculty Tutor Programme', 'Faculty Tutor Programme', 'Faculty Tutor Programme', 'Enrichment', 'Enrichment', 'Enrichment', 'Leadership', 'Leadership', 'Leadership', 'Sixth Form Prospectus', 'Sixth Form Prospectus', 'Sixth Form Prospectus', 'Open Events', 'Open Events', 'Open Events', 'Entrance Requirements', 'Entrance Requirements', 'Entrance Requirements', 'Admissions and Applications', 'Admissions and Applications', 'Admissions and Applications', 'Pastoral Care', 'Pastoral Care', 'Pastoral Care', 'Dress Code', 'Dress Code', 'Dress Code', '16+ Travel Card and Bursary', '16+ Travel Card and Bursary', '16+ Travel Card and Bursary', 'Sixth Form Transition', 'Sixth Form Transition', 'Sixth Form Transition', 'News & EventsCalendarNewsletters@OakwoodLatest Letters', 'News & Events', 'News & Events', 'Calendar', 'Calendar', 'Calendar', 'Newsletters', 'Newsletters', 'Newsletters', '@Oakwood', '@Oakwood', '@Oakwood', 'Latest Letters', 'Latest Letters', 'Latest Letters', 'Key InformationAccountsOfstedThe School Day and Opening HoursTerm Dates / Key DatesPolicies and DocumentsSafeguarding and Other AdvicePupil PremiumSEND - Student Development and SupportGovernors and TrusteesExaminationsMindfulnessParents Association', 'Key Information', 'Key Information', 'Accounts', 'Accounts', 'Accounts', 'Ofsted', 'Ofsted', 'Ofsted', 'The School Day and Opening Hours', 'The School Day and Opening Hours', 'The School Day and Opening Hours', 'Term Dates / Key Dates', 'Term Dates / Key Dates', 'Term Dates / Key Dates', 'Policies and Documents', 'Policies and Documents', 'Policies and Documents', 'Safeguarding and Other Advice', 'Safeguarding and Other Advice', 'Safeguarding and Other Advice', 'Pupil Premium', 'Pupil Premium', 'Pupil Premium', 'SEND - Student Development and Support', 'SEND - Student Development and Support', 'SEND - Student Development and Support', 'Governors and Trustees', 'Governors and Trustees', 'Governors and Trustees', 'Examinations', 'Examinations', 'Examinations', 'Mindfulness', 'Mindfulness', 'Mindfulness', 'Parents Association', 'Parents Association', 'Parents Association', 'CurriculumCurriculum OverviewCurriculum SubjectsCourse OutlinesHomeworkExtra-Curricular - ExcelEnrichmentLiteracyOPGS SportIAG - CareersLibraryWeekly Awareness TopicSustainability @OPGSHouse System', 'Curriculum', 'Curriculum', 'Curriculum Overview', 'Curriculum Overview', 'Curriculum Overview', 'Curriculum Subjects', 'Curriculum Subjects', 'Curriculum Subjects', 'Course Outlines', 'Course Outlines', 'Course Outlines', 'Homework', 'Homework', 'Homework', 'Extra-Curricular - Excel', 'Extra-Curricular - Excel', 'Extra-Curricular - Excel', 'Enrichment', 'Enrichment', 'Enrichment', 'Literacy', 'Literacy', 'Literacy', 'OPGS Sport', 'OPGS Sport', 'OPGS Sport', 'IAG - Careers', 'IAG - Careers', 'IAG - Careers', 'Library', 'Library', 'Library', 'Weekly Awareness Topic', 'Weekly Awareness Topic', 'Weekly Awareness Topic', 'Sustainability @OPGS', 'Sustainability @OPGS', 'Sustainability @OPGS', 'House System', 'House System', 'House System', 'Contact UsSend us a messageProcedure in the Event of Bad WeatherContact DetailsWorried About A Child?', 'Contact Us', 'Contact Us', 'Send us a message', 'Send us a message', 'Send us a message', 'Procedure in the Event of Bad Weather', 'Procedure in the Event of Bad Weather', 'Procedure in the Event of Bad Weather', 'Contact Details', 'Contact Details', 'Contact Details', 'Worried About A Child?', 'Worried About A Child?', 'Worried About A Child?', 'Portals', 'Portals', 'Portals', 'Main School:01622 726683', 'Main School:', '01622 726683', 'Exceptional', 'At OPGS we believe in high quality teaching and learning that engages and challenges each and every student\xa0and excellent standards of behaviour to create a positive learning climate. We offer a wide range of opportunities to extend learning beyond the classroom.', 'Head Teacher', 'As Head Teacher of Oakwood Park Grammar School I am deeply proud of our school. Our mission statement “An Exceptional Learning Experience” captures what I and my staff seek every day for your son or daughter; the opportunity to be exceptional in everything they do, with the support of teachers and support staff. High quality teaching, excellent pastoral care and an impressive range of extra-curricular opportunities are what we offer for all our students.Please visit our school to see for yourself.', 'K.W. Moody - Head Teacher', 'K.W. Moody - Head Teacher', 'More from our Head', 'History of the SchoolDiscover More', 'History of the SchoolDiscover More', 'Discover More', 'ProspectusDiscover More', 'ProspectusDiscover More', 'Discover More', 'VacanciesDiscover More', 'VacanciesDiscover More', 'Discover More', '@oakwoodDiscover More', '@oakwoodDiscover More', 'Discover More', 'News', 'Follow Us', 'Read03 MarchThe team at the Museum wants to know how we can help school students with their homework and coursework.Take part in this short survey. Closing 5 March 2023, the survey takes 3 to 7 minutes to complete: https://t.co/i1wEbo8gdu https://t.co/JLr2HUMzWU', 'Read', 'Read', '03 March', 'The team at the Museum wants to know how we can help school students with their homework and coursework.Take part in this short survey. Closing 5 March 2023, the survey takes 3 to 7 minutes to complete: https://t.co/i1wEbo8gdu https://t.co/JLr2HUMzWU', 'https://t.co/i1wEbo8gdu', 'https://t.co/JLr2HUMzWU', "Read03 MarchGuess the character is always a favourite part of World Book Day. Some of our staff rose to the challenge again. We've also brought together all of the work we have been doing on disciplinary literacy at OPGS. Developing academic rigour in literacy is key to academic success. https://t.co/dJUq6P6Ryq", 'Read', 'Read', '03 March', "Guess the character is always a favourite part of World Book Day. Some of our staff rose to the challenge again. We've also brought together all of the work we have been doing on disciplinary literacy at OPGS. Developing academic rigour in literacy is key to academic success. https://t.co/dJUq6P6Ryq", 'https://t.co/dJUq6P6Ryq', 'Read03 MarchAt OPGS, kindness, tolerance and respect are at the core of our key values, therefore we were so proud of Toby for recently supporting a member of the public who required help and reassurance.Well done Toby. https://t.co/PoJ24YVPYB', 'Read', 'Read', '03 March', 'At OPGS, kindness, tolerance and respect are at the core of our key values, therefore we were so proud of Toby for recently supporting a member of the public who required help and reassurance.Well done Toby. https://t.co/PoJ24YVPYB', 'https://t.co/PoJ24YVPYB', 'Read01 MarchWell done to Ethan on your brilliant performance in your first English Gymnastics Championship this weekend. https://t.co/0LFZLp5d6w', 'Read', 'Read', '01 March', 'Well done to Ethan on your brilliant performance in your first English Gymnastics Championship this weekend. https://t.co/0LFZLp5d6w', 'https://t.co/0LFZLp5d6w', "Read10 FebruaryOur latest edition of @oakwood is out now. We hope you enjoy reading all that we've been up to.Have a wonderful half term break. https://t.co/odik2lSI0V", 'Read', 'Read', '10 February', "Our latest edition of @oakwood is out now. We hope you enjoy reading all that we've been up to.Have a wonderful half term break. https://t.co/odik2lSI0V", '@oakwood', 'https://t.co/odik2lSI0V', 'Read10 FebruaryYear 9 Art Club students are working on pieces focusing on sustainability and the environment. https://t.co/cjiRNodIW4', 'Read', 'Read', '10 February', 'Year 9 Art Club students are working on pieces focusing on sustainability and the environment. https://t.co/cjiRNodIW4', 'https://t.co/cjiRNodIW4', 'Read08 FebruaryWe are going to need more chessboards! Our after school primary school chess club is underway. Thank you to our OPGS volunteers. https://t.co/YXhgQ0oJMt', 'Read', 'Read', '08 February', 'We are going to need more chessboards! Our after school primary school chess club is underway. Thank you to our OPGS volunteers. https://t.co/YXhgQ0oJMt', 'https://t.co/YXhgQ0oJMt', 'Read08 FebruaryAs part of #NationalApprenticeshipWeek2023 we welcomed back two former students to discuss Degree Apprenticeships with Yr 10 and 11 students. Dhruv secured a degree apprenticeship with Jaguar Landrover & Seb has just started his degree apprenticeship with the BBC. Thank you both. https://t.co/Gc86acwiSM', 'Read', 'Read', '08 February', 'As part of #NationalApprenticeshipWeek2023 we welcomed back two former students to discuss Degree Apprenticeships with Yr 10 and 11 students. Dhruv secured a degree apprenticeship with Jaguar Landrover & Seb has just started his degree apprenticeship with the BBC. Thank you both. https://t.co/Gc86acwiSM', 'https://t.co/Gc86acwiSM', 'Read06 FebruaryWe will be sharing lots of ideas and tips for making positive connections and ensuring that we look after our mental health as part of #childrensmentalhealthweek2023 Connecting with ourselves is a great place to start. @YoungMindsUK have some brilliant resources including this: https://t.co/jPH2Cx5HV5', 'Read', 'Read', '06 February', 'We will be sharing lots of ideas and tips for making positive connections and ensuring that we look after our mental health as part of #childrensmentalhealthweek2023 Connecting with ourselves is a great place to start. @YoungMindsUK have some brilliant resources including this: https://t.co/jPH2Cx5HV5', '@YoungMindsUK', 'https://t.co/jPH2Cx5HV5', 'Read06 FebruaryThank you @OPGSchool! This is why we are so grateful to work with you. We appreciate you enabling more conversations in the local community.https://t.co/FkCxb05JxA', 'Read', 'Read', '06 February', 'Thank you @OPGSchool! This is why we are so grateful to work with you. We appreciate you enabling more conversations in the local community.https://t.co/FkCxb05JxA', '@OPGSchool', 'https://t.co/FkCxb05JxA', 'Read03 FebruaryStudents discussed the importance of having mental health conversations in form time activities this week.On Monday all funds from our non-uniform day will go to our local branch of Mind @MidKentMind https://t.co/SoPmXJMNq7', 'Read', 'Read', '03 February', 'Students discussed the importance of having mental health conversations in form time activities this week.On Monday all funds from our non-uniform day will go to our local branch of Mind @MidKentMind https://t.co/SoPmXJMNq7', '@MidKentMind', 'https://t.co/SoPmXJMNq7', 'Read02 FebruaryThe national Intermediate Maths Challenge Competition is underway this morning.Good to see our top mathematicians tackling the challenge.Well done in particular to those selected from Years 8 and 9 to compete alongside students in Year 10 and 11. https://t.co/A4IzoxP8oA', 'Read', 'Read', '02 February', 'The national Intermediate Maths Challenge Competition is underway this morning.Good to see our top mathematicians tackling the challenge.Well done in particular to those selected from Years 8 and 9 to compete alongside students in Year 10 and 11. https://t.co/A4IzoxP8oA', 'https://t.co/A4IzoxP8oA', 'Follow Us', 'Points', 'Broughton0 Points The Mayor of Maidstone who signed Charles 1st death warrant.', '0', 'Points', 'The Mayor of Maidstone who signed Charles 1st death warrant.', 'Fisher0 Points The Archbishop who led the Dedication Service at the official opening in 1959.', '0', 'Points', 'The Archbishop who led the Dedication Service at the official opening in 1959.', 'Hazlitt0 Points The playwright, essayist & social commentator.', '0', 'Points', 'The playwright, essayist & social commentator.', 'Sadler0 Points An old boy who played football for Manchester United & England.', '0', 'Points', 'An old boy who played football for Manchester United & England.', 'Wilberforce0 Points A significant politician who was influential in abolishing the Slave Trade.', '0', 'Points', 'A significant politician who was influential in abolishing the Slave Trade.', 'Events', "06March Year 11 Parents' Evening4:00pm – 7:00pm", "06March Year 11 Parents' Evening4:00pm – 7:00pm", '06March', '06', 'March', '4:00pm – 7:00pm', '08March Full Gover6:00pm', '08March Full Gover6:00pm', '08March', '08', 'March', '6:00pm', '15March Primary School Link Event4:00pm – 5:30pm', '15March Primary School Link Event4:00pm – 5:30pm', '15March', '15', 'March', '4:00pm – 5:30pm', "22March Year 9 GCSE Options Parents' Information Evening7:00pm", "22March Year 9 GCSE Options Parents' Information Evening7:00pm", '22March', '22', 'March', '7:00pm', '29March Easter Drama/Music Showcase7:00pm', '29March Easter Drama/Music Showcase7:00pm', '29March', '29', 'March', '7:00pm', '31March End of TermAll Day', '31March End of TermAll Day', '31March', '31', 'March', 'All Day', '17April Start of TermAll Day', '17April Start of TermAll Day', '17April', '17', 'April', 'All Day', "24April Governors' Curriculum & Pupil Progress Committee Meeting4:30pm", "24April Governors' Curriculum & Pupil Progress Committee Meeting4:30pm", '24April', '24', 'April', '4:30pm', '26April Enrichment DayAll Day', '26April Enrichment DayAll Day', '26April', '26', 'April', 'All Day', '28April Senior Sports Dinner7:00pm', '28April Senior Sports Dinner7:00pm', '28April', '28', 'April', '7:00pm', '01May Bank HolidayAll Day', '01May Bank HolidayAll Day', '01May', '01', 'May', 'All Day', "02May Year 12 UCAS Parents' Information Evening7:00pm", "02May Year 12 UCAS Parents' Information Evening7:00pm", '02May', '02', 'May', '7:00pm', 'View Full Calendar', 'Get Here', 'Oakwood Park Grammar School,Oakwood Rd, Maidstone, Kent, ME16 8AH', '01622 726683', '01622 726683', 'office@opgs.org', 'office@opgs.org', 'Contact Us', '© 2023\xa0Oakwood Park Grammar School\t\t\t\t|School Website bye4education', '|', 'e4education', "High Visibility\t\t\t\t|Sitemap\t\t\t\t|Privacy Policy\t\t\t\t|Cookies\t$(document).ready(function() {\t\t$('#cookie_settings').on('click', function(event) { \t\t\tevent.preventDefault();\t\t\t$('.cookie_information__icon').trigger('click');\t\t});\t});", 'High Visibility', '|', 'Sitemap', '|', 'Privacy Policy', '|', 'Cookies', 'Cookie Policy', 'Click here for more information']
    content = [element for element in content if element.strip() != '']
    content = [element for element in content if len(element.split()) > 8]
    print(content)
    # content = [element for element in content if len(element) != '']
    # Return the resulting text
    return '\n'.join(set(content))


if __name__ == '__main__':
    # # Url to soup (text)
    # _ = url_to_soup_obj("https://registry.elevategreece.gov.gr/company/i-love-dyslexia-english-language-innovation-eli-ike/")
    #
    # # Write file
    # with open("HTML Files/registry.elevategreece.gov", 'w', encoding='utf-8-sig') as f:
    #     f.write(str(_))

    # Test-case company = 'AkzoNobel'
    urls = google_search(search_str="AkzoNobel")
    print(urls)

    soup1 = url_to_soup_obj(urls[0])
    soup1_text = extract_text(soup1)

    print(soup1_text)
    print('\n'.join(soup1_text))

    # Mark end of if-name-main section
    pass




